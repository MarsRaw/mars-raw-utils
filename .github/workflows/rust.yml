name: Rust

on:
  push:
    branches: [ github-actions-impl ]
  pull_request:
    branches: [ github-actions-impl ]

env:
  CARGO_TERM_COLOR: always

jobs:

  check:
    name: "Cargo check"
    runs-on: "ubuntu-latest"
    steps:
    - name: "Checkout repo"
      uses: actions/checkout@v3
      with:
        submodules: recursive
    - uses: "actions-rs/toolchain@v1"
      with:
        profile: "minimal"
        toolchain: "stable"
        override: true
    - uses: "actions-rs/cargo@v1"
      with:
        command: "check"
    
  check:
    name: "Cargo test"
    runs-on: "ubuntu-latest"
    steps:
    - name: "Checkout repo"
      uses: actions/checkout@v3
      with:
        submodules: recursive

    - uses: "actions-rs/toolchain@v1"
      with:
        profile: "minimal"
        toolchain: "stable"
        override: true

    - uses: "actions-rs/cargo@v1"
      with:
        command: "test"
  
  check:
    name: "Cargo format"
    runs-on: "ubuntu-latest"
    steps:
    - name: "Checkout repo"
      uses: actions/checkout@v3
      with:
        submodules: recursive

    - uses: "actions-rs/toolchain@v1"
      with:
        profile: "minimal"
        toolchain: "stable"
        override: true

    - run: "rustup component add rustfmt"
    
    - uses: "actions-rs/cargo@v1"
      with:
        command: "fmt"
        args: "--all -- --check"

  check:
    name: "Cargo clippy"
    runs-on: "ubuntu-latest"
    steps:
    - name: "Checkout repo"
      uses: actions/checkout@v3
      with:
        submodules: recursive

    - uses: "actions-rs/toolchain@v1"
      with:
        profile: "minimal"
        toolchain: "stable"
        override: true

    - run: "rustup component add clippy"
    
    - uses: "actions-rs/cargo@v1"
      with:
        command: "fmt"
        args: "-- -D warnings"
